<template>
  <div class="login-index-container">
    <div class="change-theme-container light-theme-thumb-layer"
         @click="changeTheme()"
    >
      <div class="change-theme-thumb">
        <span class="theme-thumb-container"
              v-show="theme === 'light'"
        >
          <svg t="1672797739174" class="icon sun-icon" viewBox="0 0 1024 1024" version="1.1"
               xmlns="http://www.w3.org/2000/svg" p-id="4755"><path
              d="M752.41931153 240.7063601c8.36993432 0 15.62255883 3.08990502 21.72821045 9.16589356 6.1353147 6.08093262 9.18566918 13.3928833 9.18566918 21.73315382 0 8.55285621-3.05035376 15.85986352-9.18566918 21.94079614l-43.67394996 43.66900658c-5.93261719 5.97216773-13.17041016 8.95825195-21.72326709 8.95825195-8.87420678 0-16.20098901-2.98608422-22.08911085-8.75061035-5.88317847-5.87329102-8.80004906-13.2890625-8.80004906-22.14843774 0-8.54791283 2.95642114-15.75604272 8.91375732-21.72821044l43.66900659-43.67394996c6.14025879-6.07598853 13.44726539-9.16589356 21.98034668-9.16589356z m37.66223167 240.39459181h61.79809547c8.52813721 0 15.82031227 2.98608422 21.83697534 9.06207276C879.78271508 496.24395728 882.78857422 503.45208717 882.78857422 512c0 8.55285621-3.00585914 15.85986352-9.07196021 21.83697533-6.01666236 6.07598853-13.30883813 9.06207276-21.83697534 9.06207276h-61.79809547c-8.52813721 0-15.80053734-2.98608422-21.86663841-9.06207276-6.01666236-5.97711182-9.05712867-13.2890625-9.05712867-21.83697533 0-8.55285621 3.04046631-15.76098609 9.05712867-21.83697533 6.06610107-6.07598853 13.33850122-9.06207276 21.86663841-9.06207276zM512 141.21142578c8.52813721 0 15.79064917 3.08990502 21.85180688 9.06207276 6.02160645 6.08093262 9.05712867 13.3928833 9.05712867 21.83697533v61.79809546c0 8.55285621-3.03552222 15.85986352-9.0521853 21.83697534-6.06610107 6.07598853-13.32861305 9.16589356-21.85675025 9.16589355-8.53802467 0-15.80053734-3.08990502-21.86663842-9.16589355-6.01666236-5.97711182-9.0521853-13.2890625-9.05218458-21.83697534V172.11047387c0-8.44409203 3.03552222-15.76098609 9.05218458-21.83697533C496.20440674 144.3013308 503.46691871 141.21142578 512.00494408 141.21142578zM271.81304907 240.7063601c8.36499023 0 15.61267066 3.08990502 21.743042 9.16589356l43.66900659 43.67394996c6.14025879 6.07598853 9.17083764 13.38793922 9.17083764 21.72821044 0 8.55285621-3.01080323 15.86480689-9.05712938 21.83697534-6.03149391 6.08093262-13.30389404 9.06207276-21.85180617 9.06207275-8.69622827 0-16.02795386-2.98608422-21.95068359-8.85443115l-43.68383814-43.67395068c-5.97216773-5.97216773-8.92858886-13.28411842-8.92858886-22.03967284 0-8.55285621 3.00585914-15.76098609 9.07196021-21.83697462 6.01666236-5.97216773 13.30883813-9.06207276 21.85675096-9.06207276h-0.03955126z m436.93725586 436.91253615c8.36499023 0 15.60772729 2.98608422 21.72326709 9.16589355l43.67394995 43.67395067c6.1353147 6.17980933 9.18566918 13.38793922 9.18566919 21.93585205 0 8.34521461-3.05035376 15.65716529-9.18566919 21.73315382-6.1105957 6.17980933-13.35827613 9.16589356-21.72326636 9.16589356-8.52813721 0-15.84008789-2.98608422-21.98034668-9.16589356l-43.66900659-43.66900587c-5.95733618-5.87329102-8.91375732-13.1852417-8.91375732-21.73315453 0-8.55285621 3.01080323-15.86480689 9.05712866-21.94079614 6.03149391-6.07598853 13.32861305-9.16589356 21.85180689-9.16589355h-0.01977564zM512.00494408 388.40380836c-34.12243628 0-63.22192359 12.05310035-87.39239525 36.2532351-24.1358645 24.10125732-36.21368384 53.25018335-36.21368384 87.34295654 0 34.0927732 12.07782007 63.24169922 36.21368384 87.44677734C448.78796387 623.53814721 477.88250709 635.59619164 512 635.59619164c34.12243628 0 63.23181176-12.05310035 87.4072268-36.15435838C623.51837158 575.2466433 635.59619164 546.09771729 635.59619164 512c0-34.0927732-12.07782007-63.24169922-36.18896484-87.34295654C575.23181176 400.45690942 546.12243628 388.40380836 512 388.40380836zM172.12036133 481.10095191h61.79809547c8.53802467 0 15.80053734 2.98608422 21.86663841 9.06207276 6.01666236 6.08093262 9.05712867 13.2890625 9.05712867 21.83697533 0 8.55285621-3.04046631 15.85986352-9.05712867 21.83697533-6.06610107 6.07598853-13.32861305 9.06207276-21.86663841 9.06207276h-61.79809547c-8.52813721 0-15.81042481-2.98608422-21.83697534-9.06207276C144.21728492 527.85986352 141.21142578 520.54791283 141.21142578 512c0-8.55285621 3.00585914-15.76098609 9.07196021-21.83697533 6.03149391-6.07598853 13.30883813-9.06207276 21.83697534-9.06207276zM512.00494408 759.19238258c8.52813721 0 15.79064917 2.98608422 21.85180617 9.06207274 6.02160645 6.08093262 9.05712867 13.2890625 9.05712938 21.83697535v61.79809546c0 8.55285621-3.03552222 15.85986352-9.0521853 21.83697533C527.79559326 879.80249 520.53308129 882.78857422 512 882.78857422c-8.53802467 0-15.80053734-2.98608422-21.86663842-9.06207276-6.01666236-5.97711182-9.0521853-13.2890625-9.05218458-21.83697533v-61.79809546c0-8.55285621 3.03552222-15.76098609 9.05218458-21.83697534 6.06610107-6.07598853 13.32861305-9.06207276 21.86663842-9.06207275z m-196.47839379-81.57348633c8.5034182 0 15.80053734 2.98608422 21.84686279 9.16589355 6.03149391 6.08093262 9.07196021 13.3928833 9.07196021 21.94079614 0 8.44409203-3.08001685 15.65222192-9.19555664 21.72821044l-43.67394995 43.67394996c-6.10565162 6.17980933-13.34838867 9.16589356-21.72326637 9.16589356-8.54791283 0-15.84008789-2.98608422-21.85180687-8.96319533-6.07104516-6.07598853-9.0769043-13.38793922-9.0769043-21.93585205 0-8.65173364 2.95642114-15.96862769 8.92858887-21.94079614l43.68383813-43.66900658c6.10565162-6.17980933 13.44232202-9.16589356 21.95068359-9.16589355h0.03955054zM512 326.60571289c33.628052 0 64.6506958 8.34521461 93.0481565 24.81811547 28.42712378 16.69042992 50.92163109 39.1404419 67.4637456 67.56756568 16.57177758 28.32824708 24.86755347 59.32617188 24.86755347 93.00860596 0 33.68243408-8.27600098 64.68035888-24.86755347 93.10748267-16.58166504 28.32824708-39.08605981 50.77825904-67.4637456 67.4637456-28.36285424 16.58166504-59.37561059 24.82305884-93.0481565 24.82305884-33.66760254 0-64.67047143-8.24139381-93.05804468-24.81811547-28.37768578-16.69042992-50.86230492-39.14538598-67.46374487-67.46868897-16.58166504-28.42712378-24.86755347-59.42504859-24.86755348-93.10748267 0-33.68243408 8.31555152-64.68035888 24.86755348-93.00860596 16.55200195-28.42712378 39.03662109-50.87713647 67.46374487-67.56262231C447.35424828 334.94598413 478.371948 326.60571289 512 326.60571289z"
              p-id="4756"></path></svg>
        </span>
        <span class="theme-thumb-container"
              v-show="theme === 'dark'"
        >
          <svg t="1672797786117" class="icon moon-icon" viewBox="0 0 1024 1024" version="1.1"
               xmlns="http://www.w3.org/2000/svg" p-id="4899"><path
              d="M703.782 179.178c31.35 18.111 60.275 40.774 85.897 67.587C858.241 318.519 896 412.714 896 512c0 51.868-10.144 102.15-30.15 149.451-19.337 45.719-47.034 86.792-82.321 122.078-35.286 35.287-76.359 62.983-122.078 82.321C614.15 885.856 563.868 896 512 896c-99.286 0-193.481-37.759-265.234-106.321-26.813-25.621-49.476-54.547-67.587-85.897C228.224 724.74 281.523 736 336 736c220.561 0 400-179.439 400-400 0-54.477-11.26-107.776-32.218-156.822M533.997 64.536C617.645 125.651 672 224.47 672 336c0 185.568-150.432 336-336 336-111.53 0-210.349-54.354-271.464-138.003C76.005 771.202 271.952 960 512 960c247.424 0 448-200.576 448-448 0-240.048-188.798-435.995-426.003-447.464zM288 224c17.6 0 32-14.4 32-32s-14.4-32-32-32h-64V96c0-17.6-14.4-32-32-32s-32 14.4-32 32v64H96c-17.6 0-32 14.4-32 32s14.4 32 32 32h64v64c0 17.6 14.4 32 32 32s32-14.4 32-32v-64h64z"
              p-id="4900"></path><path
              d="M416 416h-32v-32c0-17.6-14.4-32-32-32s-32 14.4-32 32v32h-32c-17.6 0-32 14.4-32 32s14.4 32 32 32h32v32c0 17.6 14.4 32 32 32s32-14.4 32-32v-32h32c17.6 0 32-14.4 32-32s-14.4-32-32-32z"
              p-id="4901"></path></svg>
        </span>
      </div>
    </div>
    <div class="login-wave-background">
      <div class="wave-content">
      </div>
    </div>
    <login-decoration></login-decoration>
    <login-form></login-form>
    <transition name="fade" appear>
      <login-tip v-show="isTipShow" :tip="tipContent"></login-tip>
    </transition>
  </div>
</template>

<script>
import $ from 'jquery';
import CONSTANTS from '@/assets/js/constants/pages/system/login';
import loginDecoration from "@/pages/login/components/LoginDecoration";
import loginForm from "@/pages/login/components/LoginForm";
import loginTip from "@/pages/login/components/LoginTip";
import {Timer} from "@/assets/js/utilsClass";
import {sendRequest} from "@/assets/js/common";

export default {
  name: "loginIndex",
  data() {
    return {
      theme: 'light',
      // 是否在改变主题
      isChangingTheme: false,
      // 提示内容
      tipContent: '',
      isTipShow: false,
      timer: {
        tipTimer: new Timer(),
        changeThemeTimer: new Timer(),
      },
      DOMElements: {
        head: null,
        changeThemeThumb: null,
        changeThemeContainer: null,
      }
    }
  },
  beforeMount() {
    // 绑定自定义事件
    this.$bus.$on('sendRequest', sendRequest);
    this.$bus.$on('addLoginTip', this.addLoginTip);
  },
  mounted() {
    // 初始化变量
    this.initialVariable();
    // 默认 light 主题
    this.DOMElements.head.append(CONSTANTS.THEME_CSS_LABEL.LIGHT_CSS_LABEL);
  },
  watch: {
    // 监听主题的变化
    theme: {
      handler(newValue, oldValue) {
        // 新值不等于旧值
        if (newValue !== oldValue) {
          const head = this.DOMElements.head;
          const themeCssLink = CONSTANTS.THEME_CSS_LABEL;
          const changeThemeThumb = this.DOMElements.changeThemeThumb;

          // 切换主题
          changeThemeThumb.removeClass(oldValue + '-theme-thumb-layer');
          changeThemeThumb.addClass(newValue + '-theme-thumb-layer');
          themeCssLink[oldValue.toUpperCase() + '_CSS_LABEL'].remove();
          head.append(themeCssLink[newValue.toUpperCase() + '_CSS_LABEL']);
        }
      }
    }
  },
  methods: {
    // 初始化变量
    initialVariable() {
      this.DOMElements.head = $('head');
      this.DOMElements.changeThemeThumb = $('.change-theme-thumb');
      this.DOMElements.changeThemeContainer = $('.change-theme-container');
    },
    // 改变主题
    changeTheme() {
      // 节流阀
      if (!this.isChangingTheme) {
        this.isChangingTheme = true;
        // 改变 theme 变量触发监听器
        this.theme = this.theme === 'light' ? 'dark' : 'light';
        this.timer.changeThemeTimer.timeout(() => {
          this.isChangingTheme = false;
        }, 1000);
      }
    },
    // 添加提示信息
    addLoginTip(tipContent, time) {
      if (tipContent) {
        this.tipContent = tipContent;
        this.isTipShow = true;
        // 节流阀, 显示的一直是最新的提示, 旧的会被取代
        this.timer.tipTimer.timeout(() => {
          this.isTipShow = false;
        }, time ? time : 2000); // 默认时间为 2 秒
      }
    },
  },
  beforeDestroy() {
    // 解绑事件
    for (let ele in this.DOMElements) {
      this.DOMElements[ele].off();
    }
  },
  components: {
    loginDecoration,
    loginForm,
    loginTip,
  }
}
</script>

<style scoped>
.login-index-container {
  display: flex;
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
}

/*改变主题颜色按钮*/
.change-theme-container {
  position: absolute;
  top: 20px;
  right: 20px;
  width: 56px;
  height: 29px;
  padding: 3px 0 0 3px;
  border-radius: 20px;
  box-shadow: var(--box-shadow-inset-min);
}

.light-theme-thumb-layer {
  transform: translateX(0);
}

.dark-theme-thumb-layer {
  transform: translateX(26px);
}

/*滑块*/
.change-theme-thumb {
  width: 23px;
  height: 23px;
  border-radius: 23px;
  text-align: center;
  box-shadow: var(--box-shadow-min);
  transition: var(--transition-400ms);
}

.change-theme-thumb .icon {
  transition: var(--transition-500ms);
}

.change-theme-container:hover .change-theme-thumb .icon {
  fill: #fd3d3d;
}

.change-theme-thumb .sun-icon {
  width: 23px;
  height: 23px;
}

.change-theme-thumb .moon-icon {
  width: 20px;
  height: 20px;
  vertical-align: -5px;
}

/*背景*/
.login-wave-background {
  position: absolute;
  z-index: 1;
  top: -900px;
  left: -900px;
  display: flex;
  justify-content: center;
  align-items: center;
  width: 1800px;
  height: 1800px;
  border-radius: 61% 39% 62% 38% / 55% 51% 49% 45%;
  background: -webkit-linear-gradient(left, rgba(131, 58, 180), rgba(253, 29, 29), rgba(252, 176, 69));
  box-shadow: var(--box-shadow-min);
  animation: rotate 10s linear infinite;
}

.wave-content {
  width: 90%;
  height: 90%;
  border-radius: 56% 44% 56% 44% / 49% 58% 42% 51%;
  box-shadow: var(--box-shadow-min);
  background: -webkit-linear-gradient(left, rgba(254, 172, 94), rgba(199, 121, 208), rgba(75, 192, 200));
}

.login-wave-background,
.wave-content {
  transition: var(--transition-1000ms);
}

@keyframes rotate {
  from {
    transform: rotate(0);
  }
  to {
    transform: rotate(360deg);
  }
}
</style>